<!DOCTYPE html>
<html lang="es">
  <head>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <meta name="description" content="">
	    <meta name="author" content=""> 
        <title>inicio</title>
	
        <link rel="stylesheet" href="../resources/bower_components/bootstrap/dist/css/bootstrap.css">
        <link rel="stylesheet" href="../resources/css/tema/app.min.1.css">
        <link rel="stylesheet" href="../resources/css/tema/app.min.2.css">
        <link rel="stylesheet" href="../resources/bower_components/Waves/dist/waves.css">
        <link rel="stylesheet" href="../resources/bower_components/animate.css/animate.css">
        <link rel="stylesheet" href="../resources/bower_components/form.validation/dist/css/formValidation.css">
        <link rel="stylesheet" href="../resources/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.css">
        <link rel="stylesheet" href="../resources/bower_components/font-awesome/css/font-awesome.css">
        <link rel="stylesheet" href="../resources/bower_components/datatables.net-bs/css/dataTables.bootstrap.css">
		<link rel="stylesheet" href="../resources/css/styles.css">

    
    </head>
    <body class="">
      <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-static-top"  style="margin-bottom: 0">

				<div class="row" style="margin-right: 0px;">
					<div class="col-md-4">
						<div class="navbar-header">
							<!-- AQUI EMPUEZA CUANDO SE OCULTA LA IMAGEN-->
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
			                    <span class="sr-only">Toggle navigation</span>
			                    <span class="icon-bar"></span>
			                    <span class="icon-bar"></span>
			                    <span class="icon-bar"></span>
			                </button>
		                	<a class="navbar-brand" href="index.html">PROGRAMA-GNV</a>

							<div class"img-responsive thumbnail text-center"  style="width: 461px;">
								<img src="img/logo.png"
									style="width: 60%; height: 45px; margin-left: 3.5em; margin-top: 0.5em"
									alt="Responsive-image">
							</div>
							<!--FIN DEL LOGO-->
						</div>
					</div>
					<div class="col-xs-12 col-md-5 text-center fecha"">
						<h3 style="color: orange;font-size: 15px;">
							<script>
								var meses = new Array("Enero", "Febrero", "Marzo",
										"Abril", "Mayo", "Junio", "Julio",
										"Agosto", "Septiembre", "Octubre",
										"Noviembre", "Diciembre");
								var f = new Date();
								document.write(f.getDate() + " de " + meses[f.getMonth()] + " de " + f.getFullYear());
							</script>
						</h3>
					</div>
					<div class="col-xs-12 col-md-3">
						<!--inicio de usuario y seleccion-->
						<div class="row">
							<div class="col-xs-6 col-md-6" style="margin-top: 8px;">
								<div class="row">
<!-- 									<div class="col-md-12 text-center">Usuario Conectado</div> -->
									<div class="col-md-12 text-center">
										<div data-id="${rolPrincipal.getIdrol()}" id="idRolPrincipal"></div>
										<form class=" " role="search">
											<select class="tipe form-control" name="roles" id="select-Roles" onchange="GetMenus(this)">	
											</select>
										</form>
									</div>
								</div>

							</div>
							<div class="col-xs-4 col-md-4 text-center" style="margin-top:12px;color: orange;">Conectado</div>	
							<div class="col-xs-2 col-md-2 text-center" style="">
								<div class="row">
									<div class="">
										<input value="$usuario.codper" type="hidden" id="cp">
										<a href="#" class="dropdown-toggle pull-right" style="padding: 0" data-toggle="dropdown" role="button" aria-expanded="false" id="activar">
<!-- 												#if($usuario.foto) -->
<!-- 													<img class=" c_foto img-responsive img-circle pull-left" src="img/Usuarios/$usuario.foto" style="width: 50px; height: 50px"> -->
<!-- 												#else  -->
<!-- 													<img class=" c_foto img-responsive pull-left" src="img/usuario.gif" style="width: 100px; height: 100px"> -->
<!-- 												#end  -->
											<img src="../resources/img/contacts/7.jpg" class="img-responsive img-circle pull-left" style="width: 50px;">
<!-- 										<i class="zmdi zmdi-account zmdi-hc img-circle"></i> -->
										</a>
										<ul class="dropdown-menu user outDisplay" style="margin-top: 3px;">
											<li><span class="triangle fa fa-caret-up fa-2x"></span></li>
											<li>
												<div class="col-lg-12">
													<a href="#ventana1" class="img-responsive pull-left img-circle" data-toggle="modal"> <!--<div class="icon img-responsive pull-left"></div>-->
														<!-- #if($usuario.foto) 
														<img class=" c_foto img-responsive pull-left" src="img/Usuarios/$usuario.foto" style="width: 100px; height: 100px"> 
 														#else  
 														<img class=" c_foto img-responsive pull-left" src="img/usuario.gif" style="width: 100px; height: 100px"> 
														#end  -->
														<!-- <span class="pull-left ">cambiar</span>  -->
														<img src="../resources/img/contacts/7.jpg" class="img-responsive c_foto pull-left img-circle" style="width: 100px;">
														<!-- <span class="pull-left c_foto">cambiar</span>   -->
													</a> 
													<span class="pull-left" style="padding: 30px 5px 5px 20px;">
														<strong style="color: white;">${usuario.nombres} ${usuario.ap}	${usuario.am}</strong>
													</span>
												</div>
													<div class="clearfix"></div>
													<div class="col-md-12 text-center">
														<form action="desconectar.html" style="margin-bottom: 12px;">
															<button type="submit" class="btn bgm-lightblue btn-sm  waves-effect">Desconectar</button>
															<!-- <a class="btn bgm-lightblue btn-sm waves-effect" id=""  name="xconect" value="" href="index.html">Desconectar</a> --> -->
														</form>
													</div>
											</li>
										</ul>
									</div>
								</div>	
							
							</div>
							<!--fin de usuario y de selecion-->
						</div>
					</div>
				</div>

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav collapse navbar-collapse" id="menuPrincipal">
                    <ul class="lista-menu main-menu" id="side-menu">
                       
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
        </nav>
			
        <div id="page-wrapper" >
            <div class="row" style="background: #efeeee">
                <div id="opcionesRol" class="col-md-12" style="margin:1.5em 0"></div>
                <div class="col-md-12" id="contenedor-gestion" style="margin-top: 0px;padding-top: 10px;padding-bottom: 10px">
                    
                    contenido
    				<a class="btn btn-danger  waves-effect" id=""   value="">Danger</a> 
    				<button class="btn btn-default waves-effect" >Default</button>               
    				<button class="btn btn-danger waves-effect"  type="submit">Denger</button>
    				         
                </div>
            </div>
        </div>
        <!-- /#page-wrapper -->
		
    </div>
    
    
 
    <script type="" src="../resources/bower_components/jquery/dist/jquery.js"></script>
    <script type="" src="../resources/bower_components/bootstrap/dist/js/bootstrap.js"></script>
<!--     <script type="" src="../resources/bower_components/jquery.nicescroll/dist/jquery.nicescroll.js"></script> -->
    <script type="" src="../resources/bower_components/Waves/dist/waves.js"></script>
    <!-- <script type="" src="../resources/js/Waves/dist/waves.min.js"></script> -->
    <!-- <script type="" src="../resources/js/script.js"></script> -->
    <!-- <script type="" src="../resources/js/materialize/materialize.js"></script> -->
    <script type="" src="../resources/bower_components/jquery-form/dist/jquery.form.min.js"></script>
    <script type="" src="../resources/bower_components/form.validation/dist/js/formValidation.js"></script>
    <script type="" src="../resources/bower_components/form.validation/dist/js/framework/bootstrap.js"></script>
    <script type="" src="../resources/bower_components/form.validation/dist/js/language/es_ES.js"></script>
<!--     <script type="" src="../resources/js/dataTables/jquery.dataTables.js"></script> -->
    <script type="" src="../resources/bower_components/datatables.net/js/jquery.dataTables.js"></script>
    <script type="" src="../resources/bower_components/datatables.net-bs/js/dataTables.bootstrap.js"></script>


    <script type="" src="../resources/js/tema/functions.js"></script>
    <script type="text/javascript">
	// $(function () {
	    Waves.attach('.btn',['waves-button']);
	    Waves.init();
	    ObtenerRoles();
	   	var idrol_init=0;
		function ObtenerRoles() {
			var idrol1;
			$('#select-Roles').empty();
			// var date;
			//	$.post('../usuario/obtenerRoles',function(resultado){
			//		date=resultado;		
			//	},"json");
			//	console.log('datos: ',date)
			$.ajax({
				url:"../usuario/obtenerRoles",
				dataType:"json",
				cache: false,
				success:function(resp){
					// console.log(resp)
					idrol1=resp[0].idrol;
					// return idrol1;
					// console.log('idrol_Ajax: ',idrol1)
					var selecion='';
					$('#select-Roles').append('<option value="-1" >Selecione Rol</option>')
					$(resp).each(function(index,array) {
						
						// console.log('array_idrol: ',array.idrol)
						if(idrol1==array.idrol){
							seleccion='selected'
							// console.log('entro igual',seleccion)	
						}else{
							seleccion=''
							// console.log('entro impar',seleccion)	
						}
						$('#select-Roles').append(
								'<option value="'+array.idrol+'" accesskey="'+array.idrol+'" '+seleccion+'>'+
								'<a href="">'+array.nombre+'</a>'+
								'</option>');
						var selecion='';
					})
					enviarIdrol(idrol1);	
				},
				error:function(err){
					console.log(err)
				}
				
			})	
		}
		var idrol_select;
		function enviarIdrol(id_rol){
			GetMenus(id_rol);
			idrol_select=id_rol;
		}
		var ListaMenus;
		function GetMenus(rol){
			var valor;
			//$('#select-Roles').on('change',function(){
			if(isNaN(rol)){
				valor = $(rol).val();
				
			}else{
				valor=rol;
				// console.log('es numero')
			}
			var idr=valor;
			idrol_select=valor;
			$('#contenedor-gestion').html('');
			$.ajax({
				url:'../usuario/MenuRol',
				type:'post',
				dataType:"json",
				data:{
					idrol:valor
				},
				success:function(resp){
					// $('#menuPrincipal').remove();
					//$('#menuPrincipal').html(resp);
					// ListaMenus=resp;
					console.log('respActual: ',resp);
					var name="";
					$('.lista-menu').empty();//remove igual borra todos los li dentro
					$(resp).each(function(index,item){
						var proc=item;
						$('.lista-menu').append(
								'<li class="sub-menu">'+
								'<a href="#" id="mod" data-id="'+item.idmod+'"><i class="'+item.icono+'"></i>'+
		                    	'<span class="" style="padding-left:15px;">'+item.nombre+'</span>'+
		                    	'<i class="fa arrow"></i></a>'+
		                    	'<ul class="list-procesos'+(index+1)+'" data-id="'+item.idmod+'" >'+
		                		'</ul>'+
		                    	'</li>'	
		                );
		            	$(resp[index].procesos).each(function (index1,item1){
							//	console.log('item1_',index1,' valor:',item1.nombre);
							//	console.log('item1_');
							//  var idm=$('.list-procesos').attr('data-id');
							//	console.log('codmod: '+idm);
							//	if(idm==item.idmod){}
		            		// console.log('Modulo',(index+1),'\nProceso',(index1+1),item1.nombre)
		            		var idlist='.list-procesos'+(index+1);
							//  console.log('idlist',idlist);
		            		$(idlist).append('<li class="sub-proceso"><a href="#" data-href="'+item1.enlace+'" data-id="'+item1.idproc+'" accesskey="'+item.idmod+'" data-idrol="'+idr+'" class="enlace-proc" onclick=(getGestion(this))>'+item1.nombre+'</a></li>')
							//  $('.list-procesos').removeClass('.list-procesos');
		            		$(item1.opciones).each(function(index2,item2) {
								// console.log('opciones: ',item2.nombre);
							})
		            	});
		           		$('#contenedor-gestion').html('');
					})
					ObtenerMenus(resp);
				}
			})
		} 
		function ObtenerMenus(Menus){
			ListaMenus=Menus;
		}
		function prueba(a){
			alert('Enlaceee:',$(a).data('href'));
		}

		
		function getGestion(link_gest){	
			//alert('inicio gestiones')
			// var idrol=idrol_select;
			var idrol=$(link_gest).attr('data-idrol')
			var idmod=$(link_gest).attr('accesskey')
			var idproc=$(link_gest).data('id');
			// console.log('listaMenus_gestion:',ListaMenus);      
			// console.log('idrol: ',idrol,'idmod: ',idmod,'idproc: ',idproc)
			var enlace=$(link_gest).data('href');
			// console.log(enlace)
			$.ajax({
				type:'post',
				url:enlace,
				success:function(resp){
					$('#contenedor-gestion').html(resp);
				},
				error:function(){

				}

			})
			$('#opcionesRol').html('');
			var OpcionesSistema=new Object();
			$(ListaMenus).each(function(index,menus){
					if(menus.idmod==idmod){
						// console.log('entro menu')
						$(ListaMenus[index].procesos).each(function(index1,procesos){
							if(procesos.idproc==idproc){
								// console.log('entro procesos')
									OpcionesSistema.Opciones=new Array();	
									$(procesos.opciones).each(function(index2,opciones){
										// console.log('entro acciones')	
										// console.log('Acciones',opciones.idopc,': ',opciones.nombre);									
										$('#opcionesRol').append('<button class="btn btn-primary waves-effect" name="">'+opciones.nombre+'</button>')
										OpcionesSistema.Opciones[index2]=opciones.nombre;
									})
								Get_Opciones(OpcionesSistema);	
							}
						})
					}
			})
		}
		var OpcionesSistema;
		function Get_Opciones(opc){
			var resp;
			if(opc==null){		
				// console.log('entre-if')
				resp=OpcionesSistema;
				// console.log('con nulos_',resp)
			}else{
				OpcionesSistema=opc;
				resp=opc;
				// console.log('sin nulos_',resp);
			}
			return resp;
		}
	// })
    </script>
    </body> 	
</html>