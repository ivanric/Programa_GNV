<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content=""> 
</head>
<body>
	
	<!-- <h2 style="text-align: center;">GESTION BENEFICIARIOS</h2> -->
    <div class="card z-depth-2">
     	<div class="card-header">
    		<h2 class="panel-title">GESTION BENEFICIARIOS
    			<small>Administre beneficiarios registrados en el Sistema</small>
    		</h2>
  		</div>	
	  <div class="panel-body table-responsive">
	    <div class="">
            <div class="col-md-12">
                <button id="btn-add" class="navbar-right btn btn-default waves-effect" disabled="disabled">
                    Agregar BENEFICIARIO 
                </button>
            </div>   &nbsp;
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-3 col-xs-12">
                        <input type="text"  id="filt-ben" name="" class="form-control unput-sm" placeholder="Buscar por nombres, apellidos o cedula..">
                    </div>
                    <div class="col-md-3 col-xs-12">
                    	
                    </div>
                    <div class="col-md-6 col-xs-12" style="text-align: right;">
	                	<label class="radio radio-inline m-r-20">
							<input type="radio" name="iestado" id="activos" value="1">
                        	<i class="input-helper"></i>activos
						</label>
						<label class="radio radio-inline m-r-20">
							<input type="radio" name="iestado" id="bajas" value="0"> 
                        	<i class="input-helper"></i>bajas
						</label>
						<label class="radio radio-inline m-r-20">
							<input type="radio" name="iestado" id="todos" value="-1" checked="checked"> 
                        	<i class="input-helper"></i>todos
						</label>	
                    </div>
                </div>
            </div>
            <div class="col-md-12">
        	    <table  id="table-beneficiarios" class="table table-vmiddle" width="100%" >
                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">beneficiario</th>
                            <th class="text-center">ci</th>
                            <th class="text-center">direccion</th>
                            <th class="text-center">E</th>
                            <th class="text-center">Opciones</th>
                           
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
            	</table>
            </div>   
        </div>  
	  </div>
	</div>
	 <!-- <script type="" src="../resources/js/ajax/gestion.js"></script> -->
	<script type="text/javascript">
	    $('select').chosen();

	// $(function () {
		var result=Get_Opciones(null);
		// console.log('GESTION_LIST: ',result)
		// console.log('tam: ',result.AccionesUser.length)
		if(ExisteOpcion('adicionar')){
			$('#btn-add').attr({
				onclick:"(Beneficiario.add())",
				// accesskey:""
				})
			$('#btn-add').removeAttr("disabled ").focus().val("Ahora si lo puedes utilizar")
		}

		function ExisteOpcion(opc){
			// alert('entro comparar')
			var resultado=false;
			for (var i = 0; i < result.AccionesUser.length; i++) {
				console.log('for_: ',result.AccionesUser[i]);
				if(result.AccionesUser[i]==opc){
					resultado=true;			
				}
			}
			// console.log('result_dentro:',resultado)				
			return resultado;
		}

		var filtro=$('#filt-ben').val();
		var estado=$('input[name="iestado"]:checked').val();
		listar();

		$('#filt-ben').on('keyup',function(){
			filtro=$(this).val();
			listar();
		})

		$('input[name="iestado"]').on('change',function(){
			estado=$(this).val();
			listar();
  		})
	    var DTBeneficiario='';
		function listar(){
			$.ajax({
				url:'../RestBeneficiarios/listar',
				type:'post',
				dataType:'json',
				data:{
					filtro:filtro,
					estado:estado,
				},
				success:function(resp){
					if ($.fn.DataTable.isDataTable('#table-beneficiarios')) {
						DTBeneficiario.destroy();
	           			iniciarDatable(resp);		
					} else {
						iniciarDatable(resp);
					}	
				},
				error:function(err){
					alert('sin respuesta del servidor')
				}
			})
		}
	  
	    function iniciarDatable(lista){
	    	console.log('respuestaAjax: ',lista);
	        DTBeneficiario=$('#table-beneficiarios').DataTable({
	            "oLanguage": {
	                "sUrl": "../resources/js/dataTables/Spanish.lang"
	            },
	            "dom":'rt<button>ip',
	            // "ordering":false,
	            "pageLength":5,
	            data:lista,
	            columns:[
	            	{data:'ci'},
	            	{data:'ci'},
	            	{data:'ci'},
	            	{data:'ci'},
	            	{data:'estado'},
	            	{data:'ci'},
	            ]
	            ,
	            "createdRow":function(row,data,index){
					$('td',row).eq(0).html(index+1).addClass('text-center');
					$('td',row).eq(1).html(data.ap+' '+data.am+' '+data.nombres).addClass('text-center')
					$('td',row).eq(2).html(data.ci).addClass('text-center')
					$('td',row).eq(3).html(data.direccion).addClass('text-center')
					if(data.beneficiario.estado==1){
						$('td',row).eq(4).html('<a type="button" class="" href="#" style="text-align:center"><i class="fa fa-thumbs-o-up"></i></a>').addClass('text-center').addClass('text-center');
					}else{
						$('td',row).eq(4).html('<a type="button" class="" href="#" style="text-align:center"><i class="fa fa-thumbs-o-down"></i></a>').addClass('text-center').addClass('text-center');
					}
					if(ExisteOpcion('modificar')){
						$('td',row).eq(5).html('<button id="btn-mod" class="btn btn-info btn-sm waves-effect btn-espacio" accesskey="" onclick="(Beneficiario.mod(this))"><span class="zmdi zmdi-edit"></span> Modificar</button>')
						// $('td',row).eq(5).append('<button>hola</button>')
					}else{
						$('td',row).eq(5).html('<button id="btn-mod" class="btn btn-info btn-sm waves-effect btn-espacio" disabled="disabled"><span class="zmdi zmdi-edit"></span> Modificar</button>')	
					}
					if(data.beneficiario.estado==1){
						if(ExisteOpcion('eliminar')  ){
							// if()
							$('td',row).eq(5).append('<button id="btn-elim" class="btn btn-danger btn-sm waves-effect btn-espacio" accesskey="" onclick="(Beneficiario.elim(this))"><span class="zmdi zmdi-delete"></span> Eliminar</button>');
						}else{
							$('td',row).eq(5).append('<button id="btn-elim" class="btn btn-danger btn-sm waves-effect btn-espacio" disabled="disabled"><span class="zmdi zmdi-delete"></span> Eliminar</button>');	
						}
					}else{
						if(ExisteOpcion('habilitar')){
							$('td',row).eq(5).append('<button id="btn-hab" class="btn btn-success btn-sm waves-effect btn-espacio" accesskey="" onclick="(Beneficiario.hab(this))"><span class="zmdi zmdi-time-restore-setting"></span> Habilitar</button>');
						}else{
							$('td',row).eq(5).append('<button id="btn-hab" class="btn btn-success btn-sm waves-effect btn-espacio" disabled="disabled"><span class="zmdi zmdi-time-restore-setting"></span> Habilitar</button>');	
						}						
					}

	            }
	        });
	    }
		
		var Beneficiario={
			add:function(){
				console.log('adicionar')
				$.ajax({
					url:'../Beneficiarios/modal-add',
					type:'post',
					success:function(resp){
						$('#cont-modales').html(resp);
						$('#modal-add').modal('show')

					},	
					error:function(err){
						alert('sin respuesta del servidor')
						location.href="../principal/index"
					}
				})
			},
			mod:function(a){
				console.log('modificar')	
			},
			elim:function(a){
				console.log('eliminar')	
			},
			hab:function(a){
				console.log('habilitar')	
			}

		}
	// })
	</script>
</body>
</html>